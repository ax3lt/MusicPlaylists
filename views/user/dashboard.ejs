<html>
<head>
    <%- include(global.appRoot + '/views/templates/global/header.ejs') %>
    <%- include(global.appRoot + '/views/templates/user/navbar.ejs') %>
</head>
<body data-bs-theme="<%= global.theme %>">
<div class="container">
    <h1>Dashboard</h1>
    <br>
    <div class="col-12">
        <div class="row row-cards">
            <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-auto">
                            <span class="bg-primary text-white avatar">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="icon icon-tabler icon-tabler-playlist-add" width="24" height="24"
                                     viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                     stroke-linecap="round"
                                     stroke-linejoin="round">
                                   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                   <path d="M19 8h-14"></path>
                                   <path d="M5 12h9"></path>
                                   <path d="M11 16h-6"></path>
                                   <path d="M15 16h6"></path>
                                   <path d="M18 13v6"></path>
                                </svg>
                            </span>
                            </div>
                            <div class="col">
                                <div style="font-weight: 600">
                                    Playlists create
                                </div>
                                <div class="text-muted">
                                    <%= data['playlistsCreated'] %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-auto">
                            <span class="bg-green text-white avatar"><!-- Download SVG icon from http://tabler-icons.io/i/shopping-cart -->
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="icon icon-tabler icon-tabler-chart-pie-filled" width="24" height="24"
                                     viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                     stroke-linecap="round"
                                     stroke-linejoin="round">
                                   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                   <path d="M9.883 2.207a1.9 1.9 0 0 1 2.087 1.522l.025 .167l.005 .104v7a1 1 0 0 0 .883 .993l.117 .007h6.8a2 2 0 0 1 2 2a1 1 0 0 1 -.026 .226a10 10 0 1 1 -12.27 -11.933l.27 -.067l.11 -.02z"
                                         stroke-width="0" fill="currentColor"></path>
                                   <path d="M14 3.5v5.5a1 1 0 0 0 1 1h5.5a1 1 0 0 0 .943 -1.332a10 10 0 0 0 -6.11 -6.111a1 1 0 0 0 -1.333 .943z"
                                         stroke-width="0" fill="currentColor"></path>
                                </svg>
                            </span>
                            </div>
                            <div class="col">
                                <div style="font-weight: 600">
                                    Canzoni nelle playlist
                                </div>
                                <div class="text-muted">
                                    <%= data['songsAdded'] %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-auto">
                            <span class="bg-red text-white avatar"><!-- Download SVG icon from http://tabler-icons.io/i/brand-twitter -->
                              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-heart"
                                   width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                   fill="none" stroke-linecap="round" stroke-linejoin="round">
                                   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                   <path d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572"></path>
                              </svg>
                            </span>
                            </div>
                            <div class="col">
                                <div style="font-weight: 600">
                                    Likes dati
                                </div>
                                <div class="text-muted">
                                    <%= data['likesGiven'] %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-auto">
                            <span class="bg-facebook text-white avatar"><!-- Download SVG icon from http://tabler-icons.io/i/brand-facebook -->
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="icon icon-tabler icon-tabler-world-heart"
                                     width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                     fill="none" stroke-linecap="round" stroke-linejoin="round">
                                   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                   <path d="M21 12a9 9 0 1 0 -9.679 8.974"></path>
                                   <path d="M3.6 9h16.8"></path>
                                   <path d="M3.6 15h6.9"></path>
                                   <path d="M11.5 3a17 17 0 0 0 0 18"></path>
                                   <path d="M12.5 3a16.983 16.983 0 0 1 2.556 8.136"></path>
                                   <path d="M18 22l3.35 -3.284a2.143 2.143 0 0 0 .005 -3.071a2.242 2.242 0 0 0 -3.129 -.006l-.224 .22l-.223 -.22a2.242 2.242 0 0 0 -3.128 -.006a2.143 2.143 0 0 0 -.006 3.071l3.355 3.296z"></path>
                                </svg>
                            </span>
                            </div>
                            <div class="col">
                                <div style="font-weight: 600">
                                    Likes ricevuti
                                </div>
                                <div class="text-muted">
                                    <%= data['likesReceived'] %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-4">
                <div class="card-body">
                    <h3 class="card-title">Classifica delle tue migliori 5 playlists</h3>
                    <table class="table table-sm table-borderless">
                        <thead>
                        <tr>
                            <th>Nome</th>
                            <th class="text-end">Likes</th>
                        </tr>
                        </thead>
                        <tbody>
                        <%
                        if (data['myPlaylists'].length > 0) {
                            var arrByLikes = [];
                            for (let i = 0; i < data['myPlaylists'].length; i++) {
                                arrByLikes.push({
                                    'id': data['myPlaylists'][i]._id,
                                    'titolo': data['myPlaylists'][i].title,
                                    'nLikes': data['myPlaylists'][i].likedBy.length
                                });
                            }
                            arrByLikes.sort(function (a, b) {
                                return b.nLikes - a.nLikes;
                            });
                            let max = arrByLikes[0].nLikes;
                        for(let i = 0; i < arrByLikes.length; i++){
                            if (i === 5)
                                break;
                        %>
                        <tr>
                            <td>
                                <div class="progressbg">
                                    <div class="progress progressbg-progress">
                                        <div class="progress-bar bg-primary-lt"
                                             style="width: <%= (arrByLikes[i].nLikes / max) * 100 %>%"
                                             role="progressbar"
                                             aria-valuenow="82.54" aria-valuemin="0" aria-valuemax="100"
                                             aria-label="82.54% Complete">
                                        </div>
                                    </div>
                                    <div class="progressbg-text" >
                                        <%=
                                            arrByLikes[i].titolo.length < 15 ? arrByLikes[i].titolo : arrByLikes[i].titolo.slice(0, 15) + '...';
                                        %>
                                    </div>
                                </div>
                            </td>
                            <td class="w-1 fw-bold text-end"><%= arrByLikes[i].nLikes %></td>
                        </tr>
                        <%
                        }

                        }
                        else {
                        %>
                            <tr>
                                <td>
                                    <div class="progressbg-text">Nessuna playlist creata</div>
                                </td>
                                <td class="w-1 fw-bold text-end">0</td>
                            </tr>
                        <%
                        }
                        %>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-4">
                <h3 class="card-title">Playlist da provare:</h3>
                <div class="card">
                    <div class="table-responsive">
                        <table class="table table-vcenter card-table">
                            <thead>
                            <tr>
                                <th>Playlist</th>
                                <th class=""></th>
                                <th class=""></th>
                            </tr>
                            </thead>
                            <tbody>
                            <%
                            if(data['matchingPlaylists'].length > 0){
                            for(let i = 0; i < data['matchingPlaylists'].length; i++){
                            %>
                                <tr>
                                    <td class="w-1"><img class="avatar" src="<%= data['matchingPlaylists'][i + 2] %>">
                                    </td>
                                    <td>
                                        <%= data['matchingPlaylists'][i + 1] %>
                                    </td>
                                    <td>
                                        <a href="/user/playlists/view/<%= data['matchingPlaylists'][i] %>">Visualizza</a>
                                    </td>
                                </tr>
                            <%
                                i += 2;
                            }
                            }else {
                            %>
                                <tr>
                                    <td class="w-1"><img class="avatar rounded-circle overflow-hidden" src="/images/sad_face.png"></td>
                                    <td>
                                        Non sono state trovate playlist pubbliche da provare
                                    </td>
                                    <td>
                                        <a href="/user/playlists">Crea te una playlist!</a>
                                    </td>
                                </tr>
                            <% } %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-4">
                <%
                if(data['mostLikedPublicPlaylist'].length > 1){
                %>
                <h3 class="card-title">Playlist pubblica con più likes</h3>
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="subheader"><%= data['mostLikedPublicPlaylist'][0].title %></div>
                        </div>
                        <div class="h1 mb-3">
                            <%= data['mostLikedPublicPlaylist'][0].numLikes %><span class="text-red mt-2">❤</span>
                        </div>
                        <div class="d-flex mb-2">
                            <div>Rispetto alla seconda:</div>
                            <div class="ms-auto">
                        <span class="text-green d-inline-flex align-items-center lh-1">
                          +<%=
                              data['mostLikedPublicPlaylist'][0].numLikes - data['mostLikedPublicPlaylist'][1].numLikes;
                          %>
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon ms-1" width="24" height="24"
                               viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                               stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"
                                                                                    fill="none"></path><path
                                      d="M3 17l6 -6l4 4l8 -8"></path><path d="M14 7l7 0l0 7"></path></svg>
                        </span>
                            </div>
                        </div>
                        <div class="progress progress-sm">
                            <div class="progress-bar bg-primary"
                                 style="width: <%= (data['mostLikedPublicPlaylist'][0].numLikes / (data['mostLikedPublicPlaylist'][0].numLikes + (data['mostLikedPublicPlaylist'][1].numLikes))) * 100 - 50; %>%"
                                 role="progressbar" aria-valuemin="0" aria-valuemax="100"
                                 aria-label="75% Complete">
                                <span class="visually-hidden">75% Complete</span>
                            </div>
                        </div>
                    </div>
                </div>
                <% }
                else{
                %>
                    <h3 class="card-title">Playlist pubblica con più likes</h3>
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="subheader">Non ci sono abbastanza playlist per generare statistiche</div>
                            </div>
                            <div class="h1 mb-3">
                                0
                            </div>
                            <div class="d-flex mb-2">
                                <div class="ms-auto">
                        <span class="text-green d-inline-flex align-items-center lh-1">
                          0%
                          <svg xmlns="http://www.w3.org/2000/svg" class="icon ms-1" width="24" height="24"
                               viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                               stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"
                                                                                    fill="none"></path><path
                                      d="M3 17l6 -6l4 4l8 -8"></path><path d="M14 7l7 0l0 7"></path></svg>
                        </span>
                                </div>
                            </div>
                            <div class="progress progress-sm">
                                <div class="progress-bar bg-primary" style="width: 0%" role="progressbar"
                                     aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" aria-label="75% Complete">
                                    <span class="visually-hidden">75% Complete</span>
                                </div>
                            </div>
                        </div>
                    </div>
                <%
                }
                %>
            </div>
        </div>
    </div>
</div>
<%- include(global.appRoot + '/views/templates/global/footer.ejs') %>
</body>
</html>